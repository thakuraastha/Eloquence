<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Taker Dashboard - Eloquence</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <nav class="dashboard-nav">
        <div class="nav-brand">Eloquence</div>
        <div class="nav-links">
            <a href="/taker/tests" class="nav-link">Available Tests</a>
            <a href="/taker/history" class="nav-link">My History</a>
            <a href="/profile" class="nav-link">Profile</a>
            <button id="logoutBtn" class="nav-link">Logout</button>
        </div>
    </nav>

    <main class="dashboard-content">
        <h1>Test Taker Dashboard</h1>
        
        <section class="stats-section">
            <h2>Your Progress</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Tests Completed</h3>
                    <p id="testsCompletedCount">Loading...</p>
                </div>
                <div class="stat-card">
                    <h3>Average Score</h3>
                    <p id="averageScore">Loading...</p>
                </div>
                <div class="stat-card">
                    <h3>Tests Available</h3>
                    <p id="availableTests">Loading...</p>
                </div>
            </div>
        </section>

        <section class="available-tests">
            <h2>Available Tests</h2>
            <div id="availableTestsList" class="tests-grid">
                <!-- Tests will be loaded here dynamically -->
            </div>
        </section>

        <section class="recent-attempts">
            <h2>Recent Attempts</h2>
            <div id="recentAttemptsList" class="attempts-grid">
                <!-- Recent attempts will be loaded here dynamically -->
            </div>
        </section>
    </main>

    <script>
        // Check authentication
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/login.html';
        }

        // Fetch user stats
        fetch('/api/users/stats', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('testsCompletedCount').textContent = data.testsTaken;
            document.getElementById('averageScore').textContent = 
                data.averageScore ? `${data.averageScore.toFixed(1)}%` : 'N/A';
        });

        // Fetch available tests
        fetch('/api/tests/public', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        })
        .then(res => res.json())
        .then(tests => {
            document.getElementById('availableTests').textContent = tests.length;
            const availableTestsList = document.getElementById('availableTestsList');
            availableTestsList.innerHTML = tests.slice(0, 6).map(test => `
                <div class="test-card">
                    <h3>${test.title}</h3>
                    <p>${test.description.substring(0, 100)}...</p>
                    <div class="test-card-footer">
                        <span>Type: ${test.type}</span>
                        <span>Score: ${test.totalScore}</span>
                    </div>
                    <a href="/taker/tests/${test._id}" class="take-test-btn">Take Test</a>
                </div>
            `).join('');
        });

        // Fetch recent attempts
        fetch('/api/tests/taken', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        })
        .then(res => res.json())
        .then(attempts => {
            const recentAttemptsList = document.getElementById('recentAttemptsList');
            recentAttemptsList.innerHTML = attempts.slice(0, 6).map(attempt => `
                <div class="attempt-card">
                    <h3>${attempt.test.title}</h3>
                    <div class="attempt-info">
                        <span>Score: ${attempt.score || 'Pending'}</span>
                        <span>Date: ${new Date(attempt.completedAt).toLocaleDateString()}</span>
                    </div>
                    <a href="/taker/attempts/${attempt.test._id}" class="view-attempt-btn">View Details</a>
                </div>
            `).join('');
        });

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
        });
    </script>
</body>
</html> 